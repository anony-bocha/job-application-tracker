{% extends 'applications/base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-4">
    <h2>Job Postings</h2>

    <!-- Search and Filter -->
    <form method="get" class="row g-3 mb-4 align-items-center">
        <div class="col-md-6">
            <input
                type="text"
                name="q"
                value="{{ request.GET.q|default:'' }}"
                class="form-control"
                placeholder="Search jobs by title or description..."
                aria-label="Search jobs"
            />
        </div>
        <div class="col-md-3">
            <select name="remote" class="form-select" aria-label="Filter by remote">
                <option value="" {% if not request.GET.remote %}selected{% endif %}>All Locations</option>
                <option value="yes" {% if request.GET.remote == 'yes' %}selected{% endif %}>Remote Only</option>
                <option value="no" {% if request.GET.remote == 'no' %}selected{% endif %}>On-site Only</option>
            </select>
        </div>
        <div class="col-md-3">
            <button type="submit" class="btn btn-primary w-100">
                <i class="bi bi-search me-1"></i> Search
            </button>
        </div>
    </form>

    <!-- Job Cards -->
    <div class="row">
        {% if job_postings %}
            {% for job in job_postings %}
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card h-100 shadow-sm rounded-3">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">{{ job.title }}</h5>
                            <p class="card-text flex-grow-1">
                                {{ job.description|truncatechars:120 }}
                            </p>
                            <p class="mb-1"><strong>Location:</strong> {{ job.location }}</p>
                            <p class="mb-1"><strong>Remote:</strong> {{ job.is_remote|yesno:"Yes,No" }}</p>
                            <p class="mb-1"><strong>Salary:</strong>
                                {% if job.salary_min %}{{ job.salary_min }}{% endif %} -
                                {% if job.salary_max %}{{ job.salary_max }}{% endif %}
                            </p>
                            <a href="{% url 'job_posting_detail' job.pk %}" class="btn btn-outline-primary mt-auto align-self-start">
                                View Details
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="col-12">
                <div class="alert alert-info text-center">
                    No job postings found matching your criteria.
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
